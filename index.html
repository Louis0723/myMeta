<head>
  <title>Hello World DApp</title>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
</head>
<input id="importPrivateKeyInput">
<br/> privateKey
<div id="privateKey"></div>
publicKey
<div id="address"></div>
<button id="manp">make a new privateKey</button>
<!DOCTYPE html>



<h1>A Simple Hello World Voting Application</h1>
<div class="table-responsive">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Candidate</th>
        <th>Votes</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Alice</td>
        <td id="candidate-1"></td>
      </tr>
      <tr>
        <td>Bob</td>
        <td id="candidate-2"></td>
      </tr>
      <tr>
        <td>Candy</td>
        <td id="candidate-3"></td>
      </tr>
    </tbody>
  </table>
</div>
<input type="text" id="candidate" />
<a href="#" onclick="voteForCandidate()" class="btn btn-primary">Vote</a>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/5.5.5/Rx.js"></script>
<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js"></script>

<script>
  web3 = new Web3();
  web3.setProvider(new Web3.providers.HttpProvider('https://ropsten.infura.io/Uw7vEslp5bpgqPgNkm05'))
  web3.eth.defaultAccount="0x3Fc77AA1Ff5639a54E69A544917D2Bb78775f1E7";
  var privateKey// ="0x8257f977137677a6ae4c9a6e605a81ce4a695c64c43026ed7fedf165ea7f4996"
  var address

  function setNewPrivateKey(priv) {
    let keys = localStorage.getItem('privateKeys');
    keys = !keys ? [] : JSON.parse(keys)
    if (keys.indexOf(priv) === -1) {
      keys.push(priv);
    }
    keys = JSON.stringify(keys);
    localStorage.setItem('privateKeys', keys);
  }

  sub = {
    next: (result) => {
      document.getElementById('privateKey').innerText = result.privateKey;
      setNewPrivateKey(privateKey = result.privateKey);
      document.getElementById('address').innerText = address = result.address;

    },
    error: (error) => {
      console.log('error', error);
    },
    complete: () => {
      console.log('complete')
    }
  }

  Rx.Observable.fromEvent(document.getElementById('importPrivateKeyInput'), 'input')
    .map((e) => {
      let key = e.target.value;
      let wallet = new ethers.Wallet(key.indexOf('0x') > -1 ? key : `0x${key}`)
      return wallet
    }).retry().catch((r) => {
      console.log(r)
      return Rx.Observable.of({
        privateKey: '',
        address: ''
      })
    }).subscribe(sub)
  Rx.Observable.fromEvent(document.getElementById('manp'), 'click').mergeMap(
      () => {
        return Rx.Observable.fromPromise(ethers.Wallet.fromBrainWallet(Date.now() + '', Date.now() + ''))
      })
    .subscribe(sub)

</script>

<script src="./index.js"></script>
<script charset="utf-8" src="https://cdn.ethers.io/scripts/ethers-v2.min.js" type="text/javascript"></script>
